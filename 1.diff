diff --git a/oxShibbolethWebapp/pom.xml b/oxShibbolethWebapp/pom.xml
index 70b7467..1b65ff4 100644
--- a/oxShibbolethWebapp/pom.xml
+++ b/oxShibbolethWebapp/pom.xml
@@ -18,9 +18,6 @@
         
         <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
 
-        <shibboleth.version>3.3.3</shibboleth.version>
-        <shibboleth.dist.md5>318ffa6b3992a17a0528a07a21c19865</shibboleth.dist.md5>
-
         <oxcore.version>4.0.0-SNAPSHOT</oxcore.version>
         <oxauth.version>4.0.0-SNAPSHOT</oxauth.version>
         <oxtrust.version>4.0.0-SNAPSHOT</oxtrust.version>
diff --git a/pom.xml b/pom.xml
index e2a8063..66dd672 100644
--- a/pom.xml
+++ b/pom.xml
@@ -11,9 +11,12 @@
 
 	<properties>
 		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
-        <maven.compiler.source>1.6</maven.compiler.source>
-        <maven.compiler.target>1.6</maven.compiler.target>
+		<maven.compiler.source>1.6</maven.compiler.source>
+		<maven.compiler.target>1.6</maven.compiler.target>
 		<maven.min-version>3.0.3</maven.min-version>
+
+        	<shibboleth.version>3.4.4</shibboleth.version>
+	        <shibboleth.dist.md5>1aec94ceb215361769181618b72794c6</shibboleth.dist.md5>
 	</properties>
 
 	<prerequisites>
diff --git a/static/pom.xml b/static/pom.xml
index 8ddc599..e8d8bf9 100644
--- a/static/pom.xml
+++ b/static/pom.xml
@@ -92,6 +92,9 @@
                                 <!-- Delete not required webapp folder -->
                                 <delete dir="${shib.basedir}/webapp" />
 
+                                <!-- Delete .orig files in all folders -->
+                                <delete dir="${shib.basedir}" includes="**/*.orig" />
+
                                 <!-- Delete destination shibboleth-idp folder -->
                                 <delete dir="${shib.dest.basedir}" />
 
diff --git a/static/src/main/patches/01.remove-customized-files.patch b/static/src/main/patches/01.remove-customized-files.patch
index e3fa137..4164105 100644
--- a/static/src/main/patches/01.remove-customized-files.patch
+++ b/static/src/main/patches/01.remove-customized-files.patch
@@ -1,13 +1,23 @@
 diff -aurN --ignore-all-space shibboleth-idp-3.3.3.orig/conf/idp.properties shibboleth-idp-3.3.3.gluu/conf/idp.properties
 --- shibboleth-idp-3.3.3.orig/conf/idp.properties	2018-05-15 06:49:38.000000000 +0300
 +++ shibboleth-idp-3.3.3.gluu/conf/idp.properties	1970-01-01 03:00:00.000000000 +0300
-@@ -1,196 +0,0 @@
+@@ -1,212 +0,0 @@
 -# Load any additional property resources from a comma-delimited list
 -idp.additionalProperties = /conf/ldap.properties, /conf/saml-nameid.properties, /conf/services.properties, /conf/authn/duo.properties
 -
+-# In most cases (and unless noted in the surrounding comments) the
+-# commented settings in the distributed files are the default
+-# behavior for V3.
+-#
+-# Uncomment them and change the value to change functionality.
+-
 -# Set the entityID of the IdP
 -idp.entityID = https://idp.example.org
 -
+-# Set the file path which backs the IdP's own metadata publishing endpoint at /shibboleth.
+-# Set to empty value to disable and return a 404.
+-#idp.entityID.metadataFile=%{idp.home}/metadata/idp-metadata.xml
+-
 -# Set the scope used in the attribute resolver for scoped attributes 
 -idp.scope = example.org
 -
@@ -19,6 +29,13 @@ diff -aurN --ignore-all-space shibboleth-idp-3.3.3.orig/conf/idp.properties shib
 -#idp.cookie.path =
 -#idp.cookie.maxAge = 31536000
 -
+-# HSTS/CSP response headers
+-#idp.hsts = max-age=0
+-# X-Frame-Options value, set to DENY or SAMEORIGIN to block framing
+-#idp.frameoptions = DENY
+-# Content-Security-Policy value, set to match X-Frame-Options default
+-#idp.csp = frame-ancestors 'none';
+-
 -# Set the location of user-supplied web flow definitions
 -#idp.webflows = %{idp.home}/flows
 -
@@ -47,9 +64,13 @@ diff -aurN --ignore-all-space shibboleth-idp-3.3.3.orig/conf/idp.properties shib
 -# Sets the bean ID to use as a default security configuration set
 -#idp.security.config = shibboleth.DefaultSecurityConfiguration
 -
--# To default to SHA-1, set to shibboleth.SigningConfiguration.SHA1
+-# To downgrade to SHA-1, set to shibboleth.SigningConfiguration.SHA1
 -#idp.signing.config = shibboleth.SigningConfiguration.SHA256
 -
+-# To upgrade to AES-GCM encryption, set to shibboleth.EncryptionConfiguration.GCM
+-# This is unlikely to work for all SPs, but this is a quick way to test them.
+-#idp.encryption.config = shibboleth.EncryptionConfiguration.CBC
+-
 -# Configures trust evaluation of keys used by services at runtime
 -# Defaults to supporting both explicit key and PKIX using SAML metadata.
 -#idp.trust.signatures = shibboleth.ChainingSignatureTrustEngine
@@ -104,14 +125,6 @@ diff -aurN --ignore-all-space shibboleth-idp-3.3.3.orig/conf/idp.properties shib
 -# Regular expression matching login flows to enable, e.g. IPAddress|Password
 -idp.authn.flows = Password
 -
--# Regular expression of forced "initial" methods when no session exists,
--# usually in conjunction with the idp.authn.resolveAttribute property below.
--#idp.authn.flows.initial = Password
--
--# Set to an attribute ID to resolve prior to selecting authentication flows;
--# its values are used to filter the flows to allow.
--#idp.authn.resolveAttribute = eduPersonAssurance
--
 -# Default lifetime and timeout of various authentication methods
 -#idp.authn.defaultLifetime = PT60M
 -#idp.authn.defaultTimeout = PT30M
@@ -133,8 +146,14 @@ diff -aurN --ignore-all-space shibboleth-idp-3.3.3.orig/conf/idp.properties shib
 -
 -# Set to "shibboleth.consent.AttributeConsentStorageKey" to use an attribute
 -# to key user consent storage records (and set the attribute name)
--#idp.consent.userStorageKey = shibboleth.consent.PrincipalConsentStorageKey
--#idp.consent.userStorageKeyAttribute = uid
+-#idp.consent.attribute-release.userStorageKey = shibboleth.consent.PrincipalConsentStorageKey
+-#idp.consent.attribute-release.userStorageKeyAttribute = uid
+-#idp.consent.terms-of-use.userStorageKey = shibboleth.consent.PrincipalConsentStorageKey
+-#idp.consent.terms-of-use.userStorageKeyAttribute = uid
+-
+-# Suffix of message property used as value of consent storage records when idp.consent.compareValues is true.
+-# Defaults to text displayed to the user.
+-#idp.consent.terms-of-use.consentValueMessageCodeSuffix = .text
 -
 -# Flags controlling how built-in attribute consent feature operates 
 -#idp.consent.allowDoNotRemember = true
@@ -164,6 +183,7 @@ diff -aurN --ignore-all-space shibboleth-idp-3.3.3.orig/conf/idp.properties shib
 -
 -# Set to custom bean for alternate storage of replay cache
 -#idp.replayCache.StorageService = shibboleth.StorageService
+-#idp.replayCache.strict = true
 -
 -# Toggles whether to allow outbound messages via SAML artifact
 -#idp.artifact.enabled = true
@@ -188,10 +208,6 @@ diff -aurN --ignore-all-space shibboleth-idp-3.3.3.orig/conf/idp.properties shib
 -# CAS service registry implementation class
 -#idp.cas.serviceRegistryClass=net.shibboleth.idp.cas.service.PatternServiceRegistry
 -
--# Profile flows in which the ProfileRequestContext should be exposed
--# in servlet request under the key "opensamlProfileRequestContext"
--#idp.profile.exposeProfileRequestContextInServletRequest = SAML2/POST/SSO,SAML2/Redirect/SSO
--
 -# F-TICKS auditing - set a salt to include hashed username
 -#idp.fticks.federation=MyFederation
 -#idp.fticks.algorithm=SHA-256
diff --git a/static/src/main/patches/10.saml1-removal.patch b/static/src/main/patches/10.saml1-removal.patch
index 834f797..28e06d5 100644
--- a/static/src/main/patches/10.saml1-removal.patch
+++ b/static/src/main/patches/10.saml1-removal.patch
@@ -1,239 +1,241 @@
 diff -aurN shibboleth-idp-new/conf/attribute-resolver-full.xml shibboleth-idp-old/conf/attribute-resolver-full.xml
---- shibboleth-idp-new/conf/attribute-resolver-full.xml	2018-05-15 06:49:38.000000000 +0300
-+++ shibboleth-idp-old/conf/attribute-resolver-full.xml	2019-07-07 10:51:58.000000000 +0300
-@@ -28,115 +28,96 @@
- <!--
-     <AttributeDefinition xsi:type="Simple" id="uid" sourceAttributeID="uid">
-         <Dependency ref="myLDAP" />
+--- shibboleth-idp-new/conf/attribute-resolver-full.xml.orig	2019-05-01 03:56:30.000000000 +0300
++++ shibboleth-idp-new/conf/attribute-resolver-full.xml	2019-07-07 16:18:12.894018100 +0300
+@@ -27,115 +27,96 @@
+ 
+     <AttributeDefinition xsi:type="Simple" id="uid">
+         <InputDataConnector ref="myLDAP" attributeNames="uid"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:uid" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:0.9.2342.19200300.100.1.1" friendlyName="uid" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="mail" sourceAttributeID="mail">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="mail">
+         <InputDataConnector ref="myLDAP" attributeNames="mail"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:mail" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:0.9.2342.19200300.100.1.3" friendlyName="mail" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="homePhone" sourceAttributeID="homePhone">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="homePhone">
+         <InputDataConnector ref="myLDAP" attributeNames="homePhone"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:homePhone" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:0.9.2342.19200300.100.1.20" friendlyName="homePhone" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="homePostalAddress" sourceAttributeID="homePostalAddress">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="homePostalAddress">
+         <InputDataConnector ref="myLDAP" attributeNames="homePostalAddress"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:homePostalAddress" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:0.9.2342.19200300.100.1.39" friendlyName="homePostalAddress" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="mobileNumber" sourceAttributeID="mobile">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="mobileNumber">
+         <InputDataConnector ref="myLDAP" attributeNames="mobile"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:mobile" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:0.9.2342.19200300.100.1.41" friendlyName="mobile" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="pagerNumber" sourceAttributeID="pager">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="pagerNumber">
+         <InputDataConnector ref="myLDAP" attributeNames="pager"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:pager" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:0.9.2342.19200300.100.1.42" friendlyName="pager" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="surname" sourceAttributeID="sn">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="surname">
+         <InputDataConnector ref="myLDAP" attributeNames="sn"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:sn" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.5.4.4" friendlyName="sn" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="locality" sourceAttributeID="l">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="locality">
+         <InputDataConnector ref="myLDAP" attributeNames="l"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:l" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.5.4.7" friendlyName="l" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="stateProvince" sourceAttributeID="st">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="stateProvince">
+         <InputDataConnector ref="myLDAP" attributeNames="st"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:st" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.5.4.8" friendlyName="st" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="street" sourceAttributeID="street">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="street">
+         <InputDataConnector ref="myLDAP" attributeNames="street"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:street" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.5.4.9" friendlyName="street" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="organizationName" sourceAttributeID="o">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="organizationName">
+         <InputDataConnector ref="myLDAP" attributeNames="o"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:o" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.5.4.10" friendlyName="o" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="organizationalUnit" sourceAttributeID="ou">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="organizationalUnit">
+         <InputDataConnector ref="myLDAP" attributeNames="ou"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:ou" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.5.4.11" friendlyName="ou" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="title" sourceAttributeID="title">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="title">
+         <InputDataConnector ref="myLDAP" attributeNames="title"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:title" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.5.4.12" friendlyName="title" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="postalAddress" sourceAttributeID="postalAddress">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="postalAddress">
+         <InputDataConnector ref="myLDAP" attributeNames="postalAddress"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:postalAddress" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.5.4.16" friendlyName="postalAddress" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="postalCode" sourceAttributeID="postalCode">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="postalCode">
+         <InputDataConnector ref="myLDAP" attributeNames="postalCode"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:postalCode" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.5.4.17" friendlyName="postalCode" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="postOfficeBox" sourceAttributeID="postOfficeBox">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="postOfficeBox">
+         <InputDataConnector ref="myLDAP" attributeNames="postOfficeBox"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:postOfficeBox" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.5.4.18" friendlyName="postOfficeBox" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="telephoneNumber" sourceAttributeID="telephoneNumber">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="telephoneNumber">
+         <InputDataConnector ref="myLDAP" attributeNames="telephoneNumber"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:telephoneNumber" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.5.4.20" friendlyName="telephoneNumber" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="givenName" sourceAttributeID="givenName">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="givenName">
+         <InputDataConnector ref="myLDAP" attributeNames="givenName"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:givenName" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.5.4.42" friendlyName="givenName" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="initials" sourceAttributeID="initials">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="initials">
+         <InputDataConnector ref="myLDAP" attributeNames="initials"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:initials" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.5.4.43" friendlyName="initials" encodeType="false" />
      </AttributeDefinition>
  -->
-@@ -145,37 +126,31 @@
+@@ -144,37 +125,31 @@
  <!--
-     <AttributeDefinition xsi:type="Simple" id="departmentNumber" sourceAttributeID="departmentNumber">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="departmentNumber">
+         <InputDataConnector ref="myLDAP" attributeNames="departmentNumber"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:departmentNumber" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.16.840.1.113730.3.1.2" friendlyName="departmentNumber" encodeType="false" />
      </AttributeDefinition>
      
-     <AttributeDefinition xsi:type="Simple" id="displayName" sourceAttributeID="displayName">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="displayName">
+         <InputDataConnector ref="myLDAP" attributeNames="displayName"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:displayName" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.16.840.1.113730.3.1.241" friendlyName="displayName" encodeType="false" />
      </AttributeDefinition> 
  
-     <AttributeDefinition xsi:type="Simple" id="employeeNumber" sourceAttributeID="employeeNumber">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="employeeNumber">
+         <InputDataConnector ref="myLDAP" attributeNames="employeeNumber"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:employeeNumber" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.16.840.1.113730.3.1.3" friendlyName="employeeNumber" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="employeeType" sourceAttributeID="employeeType">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="employeeType">
+         <InputDataConnector ref="myLDAP" attributeNames="employeeType"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:employeeType" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.16.840.1.113730.3.1.4" friendlyName="employeeType" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="jpegPhoto" sourceAttributeID="jpegPhoto">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="jpegPhoto">
+         <InputDataConnector ref="myLDAP" attributeNames="jpegPhoto"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:jpegPhoto" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:0.9.2342.19200300.100.1.60" friendlyName="jpegPhoto" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="preferredLanguage" sourceAttributeID="preferredLanguage">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="preferredLanguage">
+         <InputDataConnector ref="myLDAP" attributeNames="preferredLanguage"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:preferredLanguage" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.16.840.1.113730.3.1.39" friendlyName="preferredLanguage" encodeType="false" />
      </AttributeDefinition>
  -->
-@@ -184,55 +159,46 @@
- <!--
-     <AttributeDefinition xsi:type="Simple" id="eduPersonAffiliation" sourceAttributeID="eduPersonAffiliation">
-         <Dependency ref="myLDAP" />
+@@ -182,49 +157,41 @@
+ <!-- 
+     <AttributeDefinition xsi:type="Simple" id="eduPersonAffiliation">
+         <InputDataConnector ref="myLDAP" attributeNames="eduPersonAffiliation" />
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:eduPersonAffiliation" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:1.3.6.1.4.1.5923.1.1.1.1" friendlyName="eduPersonAffiliation" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="eduPersonEntitlement" sourceAttributeID="eduPersonEntitlement">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="eduPersonEntitlement">
+         <InputDataConnector ref="myLDAP" attributeNames="eduPersonEntitlement"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:eduPersonEntitlement" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:1.3.6.1.4.1.5923.1.1.1.7" friendlyName="eduPersonEntitlement" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="eduPersonNickname" sourceAttributeID="eduPersonNickname">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="eduPersonNickname">
+         <InputDataConnector ref="myLDAP" attributeNames="eduPersonNickname"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:eduPersonNickname" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:1.3.6.1.4.1.5923.1.1.1.2" friendlyName="eduPersonNickname" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Simple" id="eduPersonPrimaryAffiliation" sourceAttributeID="eduPersonPrimaryAffiliation">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="eduPersonPrimaryAffiliation">
+         <InputDataConnector ref="myLDAP" attributeNames="eduPersonPrimaryAffiliation"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:eduPersonPrimaryAffiliation" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:1.3.6.1.4.1.5923.1.1.1.5" friendlyName="eduPersonPrimaryAffiliation" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Scoped" id="eduPersonUniqueId" scope="%{idp.scope}" sourceAttributeID="localUniqueId">
-         <Dependency ref="myLDAP" />
--        <AttributeEncoder xsi:type="SAML1ScopedString" name="urn:oid:1.3.6.1.4.1.5923.1.1.1.13" encodeType="false" />
-         <AttributeEncoder xsi:type="SAML2ScopedString" name="urn:oid:1.3.6.1.4.1.5923.1.1.1.13" friendlyName="eduPersonUniqueId" encodeType="false" />
-     </AttributeDefinition>
- 
-     <AttributeDefinition xsi:type="Prescoped" id="eduPersonPrincipalName" sourceAttributeID="eduPersonPrincipalName">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Prescoped" id="eduPersonPrincipalName">
+         <InputDataConnector ref="myLDAP" attributeNames="eduPersonPrincipalName"/>
 -        <AttributeEncoder xsi:type="SAML1ScopedString" name="urn:mace:dir:attribute-def:eduPersonPrincipalName" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2ScopedString" name="urn:oid:1.3.6.1.4.1.5923.1.1.1.6" friendlyName="eduPersonPrincipalName" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Prescoped" id="eduPersonPrincipalNamePrior" sourceAttributeID="eduPersonPrincipalNamePrior">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Prescoped" id="eduPersonPrincipalNamePrior">
+         <InputDataConnector ref="myLDAP" attributeNames="eduPersonPrincipalNamePrior"/>
 -        <AttributeEncoder xsi:type="SAML1ScopedString" name="urn:oid:1.3.6.1.4.1.5923.1.1.1.12" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2ScopedString" name="urn:oid:1.3.6.1.4.1.5923.1.1.1.12" friendlyName="eduPersonPrincipalNamePrior" encodeType="false" />
      </AttributeDefinition>
  
-     <AttributeDefinition xsi:type="Scoped" id="eduPersonScopedAffiliation" scope="%{idp.scope}" sourceAttributeID="eduPersonAffiliation">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Scoped" id="eduPersonScopedAffiliation" scope="%{idp.scope}">
+         <InputDataConnector ref="myLDAP" attributeNames="eduPersonAffiliation"/>
 -        <AttributeEncoder xsi:type="SAML1ScopedString" name="urn:mace:dir:attribute-def:eduPersonScopedAffiliation" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2ScopedString" name="urn:oid:1.3.6.1.4.1.5923.1.1.1.9" friendlyName="eduPersonScopedAffiliation" encodeType="false" />
      </AttributeDefinition>
      
-     <AttributeDefinition xsi:type="Simple" id="eduPersonAssurance" sourceAttributeID="eduPersonAssurance">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition xsi:type="Simple" id="eduPersonAssurance">
+         <InputDataConnector ref="myLDAP" attributeNames="eduPersonAssurance"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:eduPersonAssurance" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:1.3.6.1.4.1.5923.1.1.1.11" friendlyName="eduPersonAssurance" encodeType="false" />
      </AttributeDefinition>
  -->
+@@ -233,7 +200,6 @@
+ <!-- 
+     <AttributeDefinition xsi:type="Scoped" id="eduPersonUniqueId" scope="%{idp.scope}">
+         <InputDataConnector ref="myLDAP" attributeNames="%{idp.persistentId.sourceAttribute}"/>
+-        <AttributeEncoder xsi:type="SAML1ScopedString" name="urn:oid:1.3.6.1.4.1.5923.1.1.1.13" encodeType="false" />
+         <AttributeEncoder xsi:type="SAML2ScopedString" name="urn:oid:1.3.6.1.4.1.5923.1.1.1.13" friendlyName="eduPersonUniqueId" encodeType="false" />
+     </AttributeDefinition>
+ -->
 diff -aurN shibboleth-idp-new/conf/attribute-resolver-ldap.xml shibboleth-idp-old/conf/attribute-resolver-ldap.xml
---- shibboleth-idp-new/conf/attribute-resolver-ldap.xml	2018-05-15 06:49:38.000000000 +0300
-+++ shibboleth-idp-old/conf/attribute-resolver-ldap.xml	2019-07-07 10:51:58.000000000 +0300
+--- shibboleth-idp-new/conf/attribute-resolver-ldap.xml.orig	2019-05-01 03:56:30.000000000 +0300
++++ shibboleth-idp-new/conf/attribute-resolver-ldap.xml	2019-07-07 16:18:12.894018100 +0300
 @@ -31,7 +31,6 @@
      -->
-     <AttributeDefinition id="eduPersonPrincipalName" xsi:type="Prescoped" sourceAttributeID="eduPersonPrincipalName">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition id="eduPersonPrincipalName" xsi:type="Prescoped" >
+         <InputDataConnector ref="myLDAP" attributeNames="eduPersonPrincipalName"/>
 -        <AttributeEncoder xsi:type="SAML1ScopedString" name="urn:mace:dir:attribute-def:eduPersonPrincipalName" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2ScopedString" name="urn:oid:1.3.6.1.4.1.5923.1.1.1.6" friendlyName="eduPersonPrincipalName" encodeType="false" />
      </AttributeDefinition>
  
 @@ -42,7 +41,6 @@
      -->
-     <AttributeDefinition id="uid" xsi:type="Simple" sourceAttributeID="uid">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition id="uid" xsi:type="Simple" >
+         <InputDataConnector ref="myLDAP" attributeNames="uid"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:uid" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:0.9.2342.19200300.100.1.1" friendlyName="uid" encodeType="false" />
      </AttributeDefinition>
  
 @@ -53,7 +51,6 @@
      -->
-     <AttributeDefinition id="mail" xsi:type="Simple" sourceAttributeID="mail">
-         <Dependency ref="myLDAP" />
+     <AttributeDefinition id="mail" xsi:type="Simple" >
+         <InputDataConnector ref="myLDAP" attributeNames="mail"/>
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:mail" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:0.9.2342.19200300.100.1.3" friendlyName="mail" encodeType="false" />
      </AttributeDefinition>
@@ -243,8 +245,8 @@ diff -aurN shibboleth-idp-new/conf/attribute-resolver.xml shibboleth-idp-old/con
 +++ shibboleth-idp-old/conf/attribute-resolver.xml	2019-07-07 10:51:58.000000000 +0300
 @@ -32,7 +32,6 @@
      -->
-     <AttributeDefinition id="eduPersonPrincipalName" xsi:type="Scoped" scope="%{idp.scope}" sourceAttributeID="uid">
-         <Dependency ref="uid" />
+     <AttributeDefinition id="eduPersonPrincipalName" xsi:type="Scoped" scope="%{idp.scope}">
+         <InputAttributeDefinition ref="uid" />
 -        <AttributeEncoder xsi:type="SAML1ScopedString" name="urn:mace:dir:attribute-def:eduPersonPrincipalName" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2ScopedString" name="urn:oid:1.3.6.1.4.1.5923.1.1.1.6" friendlyName="eduPersonPrincipalName" encodeType="false" />
      </AttributeDefinition>
@@ -260,15 +262,15 @@ diff -aurN shibboleth-idp-new/conf/attribute-resolver.xml shibboleth-idp-old/con
 @@ -53,7 +51,6 @@
      -->
      <AttributeDefinition id="mail" xsi:type="Template">
-         <Dependency ref="uid" />
+         <InputAttributeDefinition ref="uid" />
 -        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:mail" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2String" name="urn:oid:0.9.2342.19200300.100.1.3" friendlyName="mail" encodeType="false" />
          <Template>
            <![CDATA[
 @@ -68,7 +65,6 @@
      -->
-     <AttributeDefinition id="eduPersonScopedAffiliation" xsi:type="Scoped" scope="%{idp.scope}" sourceAttributeID="affiliation">
-         <Dependency ref="staticAttributes" />
+     <AttributeDefinition id="eduPersonScopedAffiliation" xsi:type="Scoped" scope="%{idp.scope}">
+         <InputDataConnector ref="staticAttributes" attributeNames="affiliation" />
 -        <AttributeEncoder xsi:type="SAML1ScopedString" name="urn:mace:dir:attribute-def:eduPersonScopedAffiliation" encodeType="false" />
          <AttributeEncoder xsi:type="SAML2ScopedString" name="urn:oid:1.3.6.1.4.1.5923.1.1.1.9" friendlyName="eduPersonScopedAffiliation" encodeType="false" />
      </AttributeDefinition>
diff --git a/static/src/main/patches/11.gluu-hostnames.patch b/static/src/main/patches/11.gluu-hostnames.patch
index a177c5c..b63c216 100644
--- a/static/src/main/patches/11.gluu-hostnames.patch
+++ b/static/src/main/patches/11.gluu-hostnames.patch
@@ -1,17 +1,17 @@
 diff -aurN --ignore-all-space shibboleth-idp-3.3.3.orig/conf/attribute-filter.xml shibboleth-idp-3.3.3.gluu/conf/attribute-filter.xml
 --- shibboleth-idp-3.3.3.orig/conf/attribute-filter.xml	2018-05-15 06:49:38.000000000 +0300
 +++ shibboleth-idp-3.3.3.gluu/conf/attribute-filter.xml	2019-02-22 10:08:15.490785100 +0300
-@@ -15,7 +15,7 @@
+@@ -78,7 +78,7 @@
  
-     <!-- Release some attributes to an SP. -->
+     <!-- Release an additional attribute to an SP. -->
      <AttributeFilterPolicy id="example1">
 -        <PolicyRequirementRule xsi:type="Requester" value="https://sp.example.org" />
 +        <PolicyRequirementRule xsi:type="Requester" value="https://ce.gluu.info" />
  
-         <AttributeRule attributeID="eduPersonPrincipalName">
-             <PermitValueRule xsi:type="ANY" />
-@@ -33,8 +33,8 @@
-     <!-- Release eduPersonAffiliation to two specific SPs. -->
+         <AttributeRule attributeID="uid" permitAny="true" />
+     </AttributeFilterPolicy>
+@@ -86,8 +86,8 @@
+     <!-- Release eduPersonScopedAffiliation to two specific SPs. -->
      <AttributeFilterPolicy id="example2">
          <PolicyRequirementRule xsi:type="OR">
 -            <Rule xsi:type="Requester" value="https://sp.example.org" />
@@ -20,7 +20,7 @@ diff -aurN --ignore-all-space shibboleth-idp-3.3.3.orig/conf/attribute-filter.xm
 +            <Rule xsi:type="Requester" value="https://anothersp.gluu.info/shibboleth" />
          </PolicyRequirementRule>
  
-         <AttributeRule attributeID="eduPersonScopedAffiliation">
+         <AttributeRule attributeID="eduPersonScopedAffiliation" permitAny="true" />
 diff -aurN --ignore-all-space shibboleth-idp-3.3.3.orig/conf/c14n/subject-c14n.xml shibboleth-idp-3.3.3.gluu/conf/c14n/subject-c14n.xml
 --- shibboleth-idp-3.3.3.orig/conf/c14n/subject-c14n.xml	2018-05-15 06:49:38.000000000 +0300
 +++ shibboleth-idp-3.3.3.gluu/conf/c14n/subject-c14n.xml	2019-02-22 10:08:15.502117600 +0300
@@ -61,8 +61,8 @@ diff -aurN --ignore-all-space shibboleth-idp-3.3.3.orig/conf/intercept/context-c
      <bean id="shibboleth.context-check.Condition" parent="shibboleth.Conditions.AND">
          <constructor-arg>
              <list>
--                <bean parent="shibboleth.Conditions.RelyingPartyId" c:candidates="#{ 'https://sp.example.org' }" />
-+                <bean parent="shibboleth.Conditions.RelyingPartyId" c:candidates="#{ 'https://sp.gluu.info' }" />
+-                <bean parent="shibboleth.Conditions.RelyingPartyId" c:candidates="#{{'https://sp.example.org'}}" />
++                <bean parent="shibboleth.Conditions.RelyingPartyId" c:candidates="#{{'https://sp.gluu.info'}}" />
                  <bean class="net.shibboleth.idp.profile.logic.SimpleAttributePredicate"
                          p:useUnfilteredAttributes="true">
                      <property name="attributeValueMap">
diff --git a/static/src/main/patches/40.oxauth_auth.patch b/static/src/main/patches/40.oxauth_auth.patch
index f5966ba..1398fda 100644
--- a/static/src/main/patches/40.oxauth_auth.patch
+++ b/static/src/main/patches/40.oxauth_auth.patch
@@ -1,7 +1,7 @@
 diff -aurN --ignore-all-space shibboleth-idp-3.3.3.orig/conf/authn/general-authn.xml shibboleth-idp-3.3.3.gluu/conf/authn/general-authn.xml
 --- shibboleth-idp-3.3.3.orig/conf/authn/general-authn.xml	2019-07-07 11:18:14.964749300 +0300
 +++ shibboleth-idp-3.3.3.gluu/conf/authn/general-authn.xml	2019-05-22 17:27:42.916581000 +0300
-@@ -122,6 +122,20 @@
+@@ -124,6 +124,20 @@
              </property>
          </bean>
  
diff --git a/static/src/main/patches/51.cusomizations.patch b/static/src/main/patches/51.cusomizations.patch
index 3bc0823..8424912 100644
--- a/static/src/main/patches/51.cusomizations.patch
+++ b/static/src/main/patches/51.cusomizations.patch
@@ -1,6 +1,6 @@
 --- shibboleth-idp/system/conf/mvc-beans.xml.orig	2019-02-22 10:08:15.544167900 +0300
 +++ shibboleth-idp/system/conf/mvc-beans.xml	2019-05-09 19:23:59.797135000 +0300
-@@ -100,7 +100,7 @@
+@@ -101,7 +101,7 @@
      </bean>
  
      <bean class="org.springframework.web.servlet.view.velocity.VelocityConfigurer">
diff --git a/static/src/main/patches/52.logo.patch b/static/src/main/patches/52.logo.patch
index 470b6af..a57e62a 100644
--- a/static/src/main/patches/52.logo.patch
+++ b/static/src/main/patches/52.logo.patch
@@ -61,7 +61,7 @@ diff -aurN --ignore-all-space shibboleth-idp-3.3.3.orig/views/logout-propagate.v
 diff -aurN --ignore-all-space shibboleth-idp-3.3.3.orig/views/logout.vm shibboleth-idp-3.3.3.gluu/views/logout.vm
 --- shibboleth-idp-3.3.3.orig/views/logout.vm	2018-05-15 06:49:38.000000000 +0300
 +++ shibboleth-idp-3.3.3.gluu/views/logout.vm	2019-07-07 10:19:38.310903400 +0300
-@@ -30,7 +30,7 @@
+@@ -34,7 +34,7 @@
      <div class="wrapper">
        <div class="container">
          <header>
